(function(){var a=this,b=a._,c={},d=Array.prototype,e=Object.prototype,f=Function.prototype,g=d.push,h=d.slice,i=d.concat,j=e.toString,k=e.hasOwnProperty,l=d.forEach,m=d.map,n=d.reduce,o=d.reduceRight,p=d.filter,q=d.every,r=d.some,s=d.indexOf,t=d.lastIndexOf,u=Array.isArray,v=Object.keys,w=f.bind,x=function(a){return a instanceof x?a:this instanceof x?void(this._wrapped=a):new x(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):a._=x,x.VERSION="1.6.0";var y=x.each=x.forEach=function(a,b,d){if(null==a)return a;if(l&&a.forEach===l)a.forEach(b,d);else if(a.length===+a.length){for(var e=0,f=a.length;f>e;e++)if(b.call(d,a[e],e,a)===c)return}else for(var g=x.keys(a),e=0,f=g.length;f>e;e++)if(b.call(d,a[g[e]],g[e],a)===c)return;return a};x.map=x.collect=function(a,b,c){var d=[];return null==a?d:m&&a.map===m?a.map(b,c):(y(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var z="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),n&&a.reduce===n)return d&&(b=x.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(y(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(z);return c},x.reduceRight=x.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),o&&a.reduceRight===o)return d&&(b=x.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=x.keys(a);f=g.length}if(y(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(z);return c},x.find=x.detect=function(a,b,c){var d;return A(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},x.filter=x.select=function(a,b,c){var d=[];return null==a?d:p&&a.filter===p?a.filter(b,c):(y(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},x.reject=function(a,b,c){return x.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},x.every=x.all=function(a,b,d){b||(b=x.identity);var e=!0;return null==a?e:q&&a.every===q?a.every(b,d):(y(a,function(a,f,g){return(e=e&&b.call(d,a,f,g))?void 0:c}),!!e)};var A=x.some=x.any=function(a,b,d){b||(b=x.identity);var e=!1;return null==a?e:r&&a.some===r?a.some(b,d):(y(a,function(a,f,g){return e||(e=b.call(d,a,f,g))?c:void 0}),!!e)};x.contains=x.include=function(a,b){return null==a?!1:s&&a.indexOf===s?-1!=a.indexOf(b):A(a,function(a){return a===b})},x.invoke=function(a,b){var c=h.call(arguments,2),d=x.isFunction(b);return x.map(a,function(a){return(d?b:a[b]).apply(a,c)})},x.pluck=function(a,b){return x.map(a,x.property(b))},x.where=function(a,b){return x.filter(a,x.matches(b))},x.findWhere=function(a,b){return x.find(a,x.matches(b))},x.max=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-1/0,e=-1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},x.min=function(a,b,c){if(!b&&x.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return y(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},x.shuffle=function(a){var b,c=0,d=[];return y(a,function(a){b=x.random(c++),d[c-1]=d[b],d[b]=a}),d},x.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=x.values(a)),a[x.random(a.length-1)]):x.shuffle(a).slice(0,Math.max(0,b))};var B=function(a){return null==a?x.identity:x.isFunction(a)?a:x.property(a)};x.sortBy=function(a,b,c){return b=B(b),x.pluck(x.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var C=function(a){return function(b,c,d){var e={};return c=B(c),y(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}};x.groupBy=C(function(a,b,c){x.has(a,b)?a[b].push(c):a[b]=[c]}),x.indexBy=C(function(a,b,c){a[b]=c}),x.countBy=C(function(a,b){x.has(a,b)?a[b]++:a[b]=1}),x.sortedIndex=function(a,b,c,d){c=B(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},x.toArray=function(a){return a?x.isArray(a)?h.call(a):a.length===+a.length?x.map(a,x.identity):x.values(a):[]},x.size=function(a){return null==a?0:a.length===+a.length?a.length:x.keys(a).length},x.first=x.head=x.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:h.call(a,0,b)},x.initial=function(a,b,c){return h.call(a,0,a.length-(null==b||c?1:b))},x.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:h.call(a,Math.max(a.length-b,0))},x.rest=x.tail=x.drop=function(a,b,c){return h.call(a,null==b||c?1:b)},x.compact=function(a){return x.filter(a,x.identity)};var D=function(a,b,c){return b&&x.every(a,x.isArray)?i.apply(c,a):(y(a,function(a){x.isArray(a)||x.isArguments(a)?b?g.apply(c,a):D(a,b,c):c.push(a)}),c)};x.flatten=function(a,b){return D(a,b,[])},x.without=function(a){return x.difference(a,h.call(arguments,1))},x.partition=function(a,b){var c=[],d=[];return y(a,function(a){(b(a)?c:d).push(a)}),[c,d]},x.uniq=x.unique=function(a,b,c,d){x.isFunction(b)&&(d=c,c=b,b=!1);var e=c?x.map(a,c,d):a,f=[],g=[];return y(e,function(c,d){(b?d&&g[g.length-1]===c:x.contains(g,c))||(g.push(c),f.push(a[d]))}),f},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(a){var b=h.call(arguments,1);return x.filter(x.uniq(a),function(a){return x.every(b,function(b){return x.contains(b,a)})})},x.difference=function(a){var b=i.apply(d,h.call(arguments,1));return x.filter(a,function(a){return!x.contains(b,a)})},x.zip=function(){for(var a=x.max(x.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=x.pluck(arguments,""+c);return b},x.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},x.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=x.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(s&&a.indexOf===s)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},x.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(t&&a.lastIndexOf===t)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},x.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var E=function(){};x.bind=function(a,b){var c,d;if(w&&a.bind===w)return w.apply(a,h.call(arguments,1));if(!x.isFunction(a))throw new TypeError;return c=h.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(h.call(arguments)));E.prototype=a.prototype;var e=new E;E.prototype=null;var f=a.apply(e,c.concat(h.call(arguments)));return Object(f)===f?f:e}},x.partial=function(a){var b=h.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===x&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},x.bindAll=function(a){var b=h.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return y(b,function(b){a[b]=x.bind(a[b],a)}),a},x.memoize=function(a,b){var c={};return b||(b=x.identity),function(){var d=b.apply(this,arguments);return x.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},x.delay=function(a,b){var c=h.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},x.defer=function(a){return x.delay.apply(x,[a,1].concat(h.call(arguments,1)))},x.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:x.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=x.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},x.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=x.now()-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=x.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},x.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},x.wrap=function(a,b){return x.partial(b,a)},x.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},x.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},x.keys=function(a){if(!x.isObject(a))return[];if(v)return v(a);var b=[];for(var c in a)x.has(a,c)&&b.push(c);return b},x.values=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},x.pairs=function(a){for(var b=x.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},x.invert=function(a){for(var b={},c=x.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},x.functions=x.methods=function(a){var b=[];for(var c in a)x.isFunction(a[c])&&b.push(c);return b.sort()},x.extend=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},x.pick=function(a){var b={},c=i.apply(d,h.call(arguments,1));return y(c,function(c){c in a&&(b[c]=a[c])}),b},x.omit=function(a){var b={},c=i.apply(d,h.call(arguments,1));for(var e in a)x.contains(c,e)||(b[e]=a[e]);return b},x.defaults=function(a){return y(h.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},x.clone=function(a){return x.isObject(a)?x.isArray(a)?a.slice():x.extend({},a):a},x.tap=function(a,b){return b(a),a};var F=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof x&&(a=a._wrapped),b instanceof x&&(b=b._wrapped);var e=j.call(a);if(e!=j.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(x.isFunction(g)&&g instanceof g&&x.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,k=!0;if("[object Array]"==e){if(i=a.length,k=i==b.length)for(;i--&&(k=F(a[i],b[i],c,d)););}else{for(var l in a)if(x.has(a,l)&&(i++,!(k=x.has(b,l)&&F(a[l],b[l],c,d))))break;if(k){for(l in b)if(x.has(b,l)&&!i--)break;k=!i}}return c.pop(),d.pop(),k};x.isEqual=function(a,b){return F(a,b,[],[])},x.isEmpty=function(a){if(null==a)return!0;if(x.isArray(a)||x.isString(a))return 0===a.length;for(var b in a)if(x.has(a,b))return!1;return!0},x.isElement=function(a){return!(!a||1!==a.nodeType)},x.isArray=u||function(a){return"[object Array]"==j.call(a)},x.isObject=function(a){return a===Object(a)},y(["Arguments","Function","String","Number","Date","RegExp"],function(a){x["is"+a]=function(b){return j.call(b)=="[object "+a+"]"}}),x.isArguments(arguments)||(x.isArguments=function(a){return!(!a||!x.has(a,"callee"))}),"function"!=typeof/./&&(x.isFunction=function(a){return"function"==typeof a}),x.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},x.isNaN=function(a){return x.isNumber(a)&&a!=+a},x.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==j.call(a)},x.isNull=function(a){return null===a},x.isUndefined=function(a){return void 0===a},x.has=function(a,b){return k.call(a,b)},x.noConflict=function(){return a._=b,this},x.identity=function(a){return a},x.constant=function(a){return function(){return a}},x.property=function(a){return function(b){return b[a]}},x.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},x.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},x.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},x.now=Date.now||function(){return(new Date).getTime()};var G={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};G.unescape=x.invert(G.escape);var H={escape:new RegExp("["+x.keys(G.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(G.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(a){x[a]=function(b){return null==b?"":(""+b).replace(H[a],function(b){return G[a][b]})}}),x.result=function(a,b){if(null==a)return void 0;var c=a[b];return x.isFunction(c)?c.call(a):c},x.mixin=function(a){y(x.functions(a),function(b){var c=x[b]=a[b];x.prototype[b]=function(){var a=[this._wrapped];return g.apply(a,arguments),M.call(this,c.apply(x,a))}})};var I=0;x.uniqueId=function(a){var b=++I+"";return a?a+b:b},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var J=/(.)^/,K={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},L=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(a,b,c){var d;c=x.defaults({},c,x.templateSettings);var e=new RegExp([(c.escape||J).source,(c.interpolate||J).source,(c.evaluate||J).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(L,function(a){return"\\"+K[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,x);var i=function(a){return d.call(this,a,x)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},x.chain=function(a){return x(a).chain()};var M=function(a){return this._chain?x(a).chain():a};x.mixin(x),y(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=d[a];x.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],M.call(this,c)}}),y(["concat","join","slice"],function(a){var b=d[a];x.prototype[a]=function(){return M.call(this,b.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return x})}).call(this),!function(a){"use strict";var b=function(a,b,c,d){var e,f=b.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"").split("."),g=0,h=f.length;if(arguments.length>2){for(e=a,h--;h>g;)b=f[g++],a=a[b]=_.isObject(a[b])?a[b]:{};d?_.isArray(a)?a.splice(f[g],1):delete a[f[g]]:a[f[g]]=c,c=e}else{for(;null!=(a=a[f[g++]])&&h>g;);c=h>g?void 0:a}return c},c={};c.VERSION="0.1.0",c.debug=!0,c.exit=function(a,b,d,e){if(c.debug){var f={};f.noJSON="Not a JSON",f.noString="Not a String",f.noArray="Not an Array",f.missing="Missing argument";var g={source:a,data:d,value:e};g.message=f[b]?f[b]:"No particular reason",console.log("Error",g)}},c.is=function(a){return"[object Object]"==toString.call(a)},c.isStringified=function(a){var b=!1;try{b=/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}catch(c){}return b},c.get=function(a,d){return void 0==a?c.exit("get","missing","json",a):void 0==d?c.exit("get","missing","selector",d):_.isString(d)?b(a,d):c.exit("get","noString","selector",d)},c.set=function(a,d,e){return void 0==a?c.exit("set","missing","json",a):void 0==d?c.exit("set","missing","selector",d):_.isString(d)?e?b(a,d,e):c.remove(a,d):c.exit("set","noString","selector",d)},c.remove=function(a,d){return void 0==a?c.exit("remove","missing","json",a):void 0==d?c.exit("remove","missing","selector",d):_.isString(d)?b(a,d,null,!0):c.exit("remove","noString","selector",d)},c.push=function(a,b,d,e){if(void 0==a)return c.exit("push","missing","json",a);if(void 0==b)return c.exit("push","missing","selector",b);var f=c.get(a,b);if(!_.isArray(f)){if(!e)return c.exit("push","noArray","array",f);f=[]}return f.push(d),c.set(a,b,f)},c.unshift=function(a,b,d){if(void 0==a)return c.exit("unshift","missing","json",a);if(void 0==b)return c.exit("unshift","missing","selector",b);if(void 0==d)return c.exit("unshift","missing","value",d);var e=c.get(a,b);return _.isArray(e)?(e.unshift(d),c.set(a,b,e)):c.exit("unshift","noArray","array",e)},c.flatten=function(a){function b(a,c){if(Object(a)!==a)d[c]=a;else if(Array.isArray(a))for(var e=0,f=a.length;f>e;e++)b(a[e],c?c+"."+e:""+e),0==f&&(d[c]=[]);else{var g=!0;for(var h in a)g=!1,b(a[h],c?c+"."+h:h);g&&(d[c]={})}}if("Object"!=a.constructor.name)return c.exit("flatten","noJSON","json",a);var d={};return b(a,""),d},c.unflatten=function(a){if(Object(a)!==a||Array.isArray(a))return a;var b,c,d,e,f,g={};for(var h in a){b=g,c="",e=0;do d=h.indexOf(".",e),f=h.substring(e,-1!==d?d:void 0),b=b[c]||(b[c]=isNaN(parseInt(f))?{}:[]),c=f,e=d+1;while(d>=0);b[c]=a[h]}return g[""]},c.prettyprint=function(a){return JSON.stringify(a,void 0,2)},a._=a._||{},a._.json=c,a._json=c}(this,String),!function(a){"use strict";var b,c,d="way",e=function(){this._watchers={},this._watchersAll={}};e.prototype.constructor=e,e.prototype.watchAll=function(a){this._watchersAll=this._watchersAll||[],_.contains(this._watchersAll,a)||this._watchersAll.push(a)},e.prototype.watch=function(a,b){this._watchers||(this._watchers={}),this._watchers[a]=this._watchers[a]||[],this._watchers[a].push(b)},e.prototype.findWatcherDeps=function(a){var b=[],c=_.keys(this._watchers);return c.forEach(function(c){g(a,c)&&b.push(c)}),b},e.prototype.emitChange=function(a){this._watchers||(this._watchers={});var b=this,c=b.findWatcherDeps(a);c.forEach(function(a){this._watchers[a]&&this._watchers[a].forEach(function(c){c.apply(b,[b.get(a)])})}),b._watchersAll&&_.isArray(b._watchersAll)&&b._watchersAll.forEach(function(c){_.isFunction(c)&&c.apply(b,[a,b.get(a)])})};var f=function(){this.data={},this._bindings={},this.options={persistent:!0,timeoutInput:50,timeoutDOM:500}};f.prototype=Object.create(e.prototype),f.constructor=f,f.prototype.dom=function(a){return this._element=c.dom(a).get(0),this},f.prototype.toStorage=function(a,b){var c=this,b=b||c._element,a=a||c.dom(b).getOptions(),d=c.dom(b).toJSON(a),e=c.dom(b).scope(),f=e?e+"."+a.data:a.data;return a.readonly?!1:void c.set(f,d,a)},f.prototype.toJSON=function(a,b){var c=this,b=b||c._element,d=c.dom(b).getValue(),a=a||c.dom(b).getOptions();return _.isArray(a.pick)&&(d=k(d,a.pick,!0)),_.isArray(a.omit)&&(d=k(d,a.omit,!1)),d},f.prototype.fromStorage=function(a,b){var c=this,b=b||c._element,a=a||c.dom(b).getOptions();if(a.writeonly)return!1;var d=c.dom(b).scope(),e=d?d+"."+a.data:a.data,f=c.get(e);c.dom(b).fromJSON(f,a)},f.prototype.fromJSON=function(a,b,c){var d=this,c=c||d._element,b=b||d.dom(c).getOptions();if(b.writeonly)return!1;if(_.isObject(a)){_.isArray(b.pick)&&(a=k(a,b.pick,!0)),_.isArray(b.omit)&&(a=k(a,b.omit,!1));var e=_.isObject(d.dom(c).toJSON())?d.dom(c).toJSON():{};a=_.extend(e,a)}b.json&&(a=_json.isStringified(a)?a:_json.prettyprint(a)),d.dom(c).setValue(a,b)},f.prototype.getValue=function(a){var b=this,a=a||b._element,d={SELECT:function(){return c.dom(a).val()},INPUT:function(){var b=c.dom(a).type();return _.contains(["text","password"],b)?c.dom(a).val():_.contains(["checkbox","radio"],b)?c.dom(a).prop("checked")?c.dom(a).val():null:void 0},TEXTAREA:function(){return c.dom(a).val()}},e=function(){c.dom(a).html()},f=c.dom(a).get(0).tagName,g=d[f]||e;return g()},f.prototype.setValue=function(a,b,d){var e=this,d=d||e._element,b=b||e.dom(d).getOptions(),f={SELECT:function(a){c.dom(d).val(a)},INPUT:function(a){_.isString(a)||(a=JSON.stringify(a));var b=c.dom(d).get(0).type;_.contains(["text","password"],b)&&c.dom(d).val(a||""),_.contains(["checkbox","radio"],b)&&(a===c.dom(d).val()?c.dom(d).prop("checked",!0):c.dom(d).prop("checked",!1))},TEXTAREA:function(a){_.isString(a)||(a=JSON.stringify(a)),c.dom(d).val(a||"")},PRE:function(a){b.html?c.dom(d).html(a):c.dom(d).text(a)},IMG:function(a){if(!a)return a=b.default||"",c.dom(d).attr("src",a),!1;var e=function(a,b){c.dom(d).addClass("way-loading"),c.dom("img",{src:a,onerror:function(){b(!1)},onload:function(){b(!0)}})};e(a,function(e){c.dom(d).removeClass("way-loading"),e?c.dom(d).removeClass("way-error").addClass("way-success"):(a?c.dom(d).addClass("way-error"):c.dom(d).removeClass("way-error").removeClass("way-success"),a=b.default||""),c.dom(d).attr("src",a)})}},g=function(a){b.html?c.dom(d).html(a):c.dom(d).text(a)},h=c.dom(d).get(0).tagName,i=f[h]||g;i(a)},f.prototype.setDefault=function(a,b,c){var d=this,c=c||d._element,a=a||!1,b=b?_.extend(d.dom(c).getOptions(),b):d.dom(c).getOptions();return b.default?void(a?d.set(b.data,b.default,b):d.dom(c).setValue(b.default,b)):!1},f.prototype.setDefaults=function(){var a=this,b="["+d+"-default]",e=c.dom(b).get();for(var f in e){var g=e[f],h=a.dom(g).getOptions(),i=h.data||null,j=i?a.get(i):null;j||a.dom(g).setDefault()}},f.prototype.registerBindings=function(){var a=this,b="["+d+"-data]";a._bindings={};var e=c.dom(b).get();for(var f in e){var g=e[f],h=a.dom(g).getOptions(),i=a.dom(g).scope(),b=i?i+"."+h.data:h.data;a._bindings[b]=a._bindings[b]||[],_.contains(a._bindings[b],c.dom(g).get(0))||a._bindings[b].push(c.dom(g).get(0))}},f.prototype.updateBindings=function(a){var b=this;b._bindings=b._bindings||{};var d=l(b._bindings,a);d.forEach(function(a){var d=c.dom(a).get(0)===c.dom(":focus").get(0)?!0:!1;d||b.dom(a).fromStorage()}),b._bindings.__all__&&b._bindings.__all__.forEach(function(a){b.dom(a).fromJSON(b.data)})},f.prototype.registerRepeats=function(){var a=this,b="["+d+"-repeat]";a._repeats=a._repeats||{},a._repeatsCount=a._repeatsCount||0;var e=c.dom(b).get();for(var f in e){var g=e[f],h=a.dom(g).getOptions();a._repeats[h.repeat]=a._repeats[h.repeat]||[];var i=d+'-repeat-wrapper="'+a._repeatsCount+'"',j=c.dom(g).parent("["+i+"]");if(!j.length){a._repeats[h.repeat].push({id:a._repeatsCount,element:c.dom(g).clone(!0).removeAttr(d+"-repeat").get(0),selector:h.repeat});var k=document.createElement("div");c.dom(k).attr(d+"-repeat-wrapper",a._repeatsCount),c.dom(k).attr(d+"-scope",h.repeat),c.dom(g).replaceWith(k),a.updateRepeats(h.repeat),a._repeatsCount++}}},f.prototype.updateRepeats=function(a){var b=this;b._repeats=b._repeats||{};var e=l(b._repeats,a);e.forEach(function(a){var e="["+d+'-repeat-wrapper="'+a.id+'"]',f=b.get(a.selector),g=[];c.dom(e).empty();for(var h in f){c.dom(a.element).attr(d+"-scope",h);var i=c.dom(a.element).get(0).outerHTML;i=i.replace(/\$\$key/gi,h),g.push(i)}c.dom(e).html(g),b.registerBindings(),b.updateBindings()})},f.prototype.updateForms=function(){var a=this,b="form["+d+"-data]",e=c.dom(b).get();for(var f in e){var g=e[f],i=a.dom(g).getOptions(),j=i.data;c.dom(g).removeAttr(d+"-data");var k=c.dom(g).find("[name]").reverse().get();for(var f in k){var l=k[f],m=c.dom(l).attr("name");if(h(m,"[]")){var n=m.split("[]")[0],o="[name^='"+n+"']",p=c.dom(g).find(o).get().length;m=n+"."+p}var b=j+"."+m;i.data=b,a.dom(l).setOptions(i),c.dom(l).removeAttr("name")}}},f.prototype.registerDependencies=function(){this.registerBindings(),this.registerRepeats()},f.prototype.updateDependencies=function(a){this.updateBindings(a),this.updateRepeats(a),this.updateForms(a)},f.prototype.setOptions=function(a,b){var e=this,b=e._element||b;for(var f in a){var g=d+"-"+f,h=a[f];c.dom(b).attr(g,h)}},f.prototype.getOptions=function(a){var b=this,a=a||b._element,c={data:null,html:!1,readonly:!1,writeonly:!1,persistent:!1};return _.extend(c,b.dom(a).getAttrs(d))},f.prototype.getAttrs=function(a,b){var d=this,b=b||d._element,e=function(a,b){var c={pick:"array",omit:"array",readonly:"boolean",writeonly:"boolean",json:"boolean",html:"boolean",persistent:"boolean"},d={array:function(a){return a.split(",")},"boolean":function(a){return"true"===a?!0:"false"===a?!1:!0}},e=function(){return b},f=c[a]||null,g=d[f]||e;return g(b)},f={},h=c.dom(b).get(0).attributes;for(var i in h){var j=h[i],k=a&&g(j.name,a+"-")?!0:!1;if(k){var l=a?j.name.slice(a.length+1,j.name.length):j.name,m=e(l,j.value);f[l]=m}}return f},f.prototype.scope=function(a,b){var e=this,b=b||e._element,f=d+"-scope",g=d+"-scope-break",h=[],i="",j="["+g+"], ["+f+"]",k=c.dom(b).parents(j).get();for(var l in k){var m=k[l];if(c.dom(m).attr(g))break;var n=c.dom(m).attr(f);h.unshift(n)}return c.dom(b).attr(f)&&h.push(c.dom(b).attr(f)),c.dom(b).attr(g)&&(h=[]),i=h.join(".")},f.prototype.get=function(a){var b=this;return void 0===a||_.isString(a)?b.data?a?_json.get(b.data,a):b.data:{}:!1},f.prototype.set=function(a,b,c){if(!a)return!1;if("this"===a.split(".")[0])return console.log('Sorry, "this" is a reserved word in way.js'),!1;var d=this;if(c=c||{},a){if(!_.isString(a))return!1;d.data=d.data||{},d.data=a?_json.set(d.data,a,b):{},d.updateDependencies(a),d.emitChange(a,b),c.persistent&&d.backup(a)}},f.prototype.push=function(a,b,c){if(!a)return!1;var d=this;c=c||{},a&&(d.data=a?_json.push(d.data,a,b,!0):{}),d.updateDependencies(a),d.emitChange(a,null),c.persistent&&d.backup(a)},f.prototype.remove=function(a,b){var c=this;b=b||{},c.data=a?_json.remove(c.data,a):{},c.updateDependencies(a),c.emitChange(a,null),b.persistent&&c.backup(a)},f.prototype.clear=function(){this.remove(null,{persistent:!0})},f.prototype.backup=function(){var a=this;if(a.options.persistent)try{var b=a.data||{};localStorage.setItem(d,JSON.stringify(b))}catch(c){console.log("Your browser does not support localStorage.")}},f.prototype.restore=function(){var a=this;if(a.options.persistent)try{var b=localStorage.getItem(d);try{b=JSON.parse(b);for(var c in b)a.set(c,b[c])}catch(e){}}catch(e){console.log("Your browser does not support localStorage.")}};var g=function(a,b){return""===b?!0:null===a||null===b?!1:(a=String(a),b=String(b),a.length>=b.length&&a.slice(0,b.length)===b)},h=function(a,b){return""===b?!0:null===a||null===b?!1:(a=String(a),b=String(b),a.length>=b.length&&a.slice(a.length-b.length,a.length)===b)},i=function(a){return _.pick(a,_.compact(_.keys(a)))},j=function(a,b,c){var d=_.keys(a);return d.forEach(function(d){c?g(d,b)||delete a[d]:g(d,b)&&delete a[d]}),a},k=function(a,b,c){var d=_json.flatten(a);for(var e in b)d=j(d,b[e],c);var f=_json.unflatten(d);return i(f)},l=function(a,b){var c=[];if(b){var d=b.split("."),e=d[d.length-1],f=!isNaN(e);if(f){d.pop();var h=d.join(".");c=a[h]?_.union(c,a[h]):c}for(var h in a)g(h,b)&&(c=_.union(c,a[h]))}else for(var h in a)c=_.union(c,a[h]);return c},m=function(a){return a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):a},n=function(){};n.constructor=n,n.prototype.dom=function(a,b){var c=this,d=[];if(!b)return _.isString(a)?d=[].slice.call(document.querySelectorAll(a)):_.isObject(a)&&a.attributes&&(d=[a]),c._elements=d,c.length=d.length,c;var e=document.createElement(a);for(var f in b)e[f]=b[f]},n.prototype.on=function(a,b){var c=this,d=c._elements;a=a.split(" ");for(var e=0,f=d.length;f>e;e++)for(var g=d[e],h=0,i=a.length;i>h;h++)g.addEventListener&&g.addEventListener(a[h],b,!1)},n.prototype.find=function(a){var b=this,c=b.get(0),d=[];return _.isString(a)&&(d=[].slice.call(c.querySelectorAll(a))),b._elements=d,b},n.prototype.get=function(a,b){var c=this,d=c._elements||[],e=d[a]||{};return b?(c._element=e,c):_.isNumber(a)?e:d},n.prototype.reverse=function(){return this._elements=this._elements.reverse(),this},n.prototype.val=function(a){return this.prop("value",a)},n.prototype.type=function(a){return this.prop("type",a)},n.prototype.html=function(a){return this.prop("innerHTML",a)},n.prototype.text=function(a){return this.prop("innerHTML",m(a))},n.prototype.prop=function(a,b){var c=this,d=c._elements;for(var e in d){if(_.isUndefined(b))return d[e][a];d[e][a]=b}},n.prototype.attr=function(a,b){var c=this,d=c._elements;for(var e in d){if(void 0===b)return d[e].getAttribute(a);d[e].setAttribute(a,b)}return c},n.prototype.removeAttr=function(a){var b=this;for(var c in b._elements)b._elements[c].removeAttribute(a);return b},n.prototype.addClass=function(a){var b=this;for(var c in b._elements)b._elements[c].classList.add(a);return b},n.prototype.removeClass=function(a){var b=this;for(var c in b._elements)b._elements[c].classList.remove(a);return b},n.prototype.parents=function(a){for(var b=this,c=b.get(0),d=c.parentNode,e=[];null!==d;){var f=d,g=a&&f.matches?f.matches(a):!0,h=void 0!==f.doctype?!0:!1;g&&!h&&e.push(f),d=f.parentNode}return b._elements=e,b},n.prototype.parent=function(a){var b=this,c=b.get(0),d=c.parentNode,e=a?d.matches(a):!0;return e?d:{}},n.prototype.clone=function(a){var b=this,c=b.get(0),d=c.cloneNode(!0);return b._elements=[d],a?b:d},n.prototype.empty=function(a){var b=this,c=b.get(0);if(!c||!c.hasChildNodes)return a?b:c;for(;c.hasChildNodes();)c.removeChild(c.lastChild);return a?b:c},n.prototype.replaceWith=function(a){var b=this,c=b.get(0),d=c.parentNode;d.replaceChild(a,c)},n.prototype.ready=function(a){document.onreadystatechange=function(){"complete"===document.readyState&&a()}},b=new f;var o=null,p=function(a){o&&clearTimeout(o),o=setTimeout(function(){var d=c.dom(a.target).get(0);b.dom(d).toStorage()},b.options.timeout)},q=function(a){a.preventDefault();var c=b.dom(this).getOptions();b.remove(c.data,c)},r=function(a){a.preventDefault();var c=b.dom(this).getOptions();if(!c||!c["action-push"])return!1;var d=c["action-push"].split(":"),e=d[0]||null,f=d[1]||null;b.push(e,f,c)},s=function(a){a.preventDefault();var c=b.dom(this).getOptions();return c&&c["action-remove"]?void b.remove(c["action-remove"],c):!1},t=null,u=function(){t&&clearTimeout(t),t=setTimeout(function(){b.registerDependencies(),v()},b.options.timeoutDOM)};c=new n;var v=function(){c.dom("body").on("DOMSubtreeModified",u),c.dom("["+d+"-data]").on("input change",p),c.dom("["+d+"-clear]").on("click",q),c.dom("["+d+"-action-remove]").on("click",s),c.dom("["+d+"-action-push]").on("click",r)},w=function(){v(),b.restore(),b.setDefaults(),b.registerDependencies(),b.updateDependencies()};c.ready(w),a.way=b}(this);