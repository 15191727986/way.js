var tagPrefix="way";$(document).on("keyup change","form["+tagPrefix+"-data] :input",function(a){a=$(a.target).parents("form");$(a).toStorage()});$(document).on("keyup change",":input["+tagPrefix+"-data]",function(a){a=$(a.target);$(a).toStorage()});$.fn.toStorage=function(a){a=a||$(this).getBindOptions();var b=Number(a.timeout)||0,c=$(this).toJSON(a);if(a.readonly)return!1;_.throttle(function(){$.setBinding(a.data,c)},b)()};
$.fn.toJSON=function(a){var b=$(this).getValue();a=a||$(this).getBindOptions();_.isArray(a.pick)&&(b=_.pick(b,a.pick));_.isArray(a.omit)&&(b=_.omit(b,a.omit));return b};$.fn.fromJSON=function(a,b){b=b||$(this).getBindOptions();var c=$(this).toJSON();if(c==a||b.writeonly)return!1;_.isObject(a)&&(_.isArray(b.pick)&&(a=_.pick(a,b.pick)),_.isArray(b.omit)&&(a=_.omit(a,b.omit)),a=_.extend(c,a));$(this).setValue(a)};
$.fn.fromStorage=function(a){a=a||$(this).getBindOptions();var b=$.getBinding(a.data);$(this).fromJSON(b,a)};$.fn.getValue=function(){var a=this,b=function(b){$(a).html()};return({FORM:function(){return form2js($(a).get(0))},INPUT:function(){return $(a).val()},TEXTAREA:function(){return $(a).val()}}[$(a).get(0).tagName]||b)()};
$.fn.setValue=function(a){var b=this,c=function(a){$(b).html(a)};return({FORM:function(a){js2form($(b).get(0),a)},INPUT:function(a){$(b).val(a||"")},TEXTAREA:function(a){$(b).val(a||"")},IMG:function(a){var c=function(a,b){$("<img>",{src:a,error:function(){b(!1)},load:function(){b(!0)}})};try{c(a,function(c){c||(a=($(b).getBindOptions()||{}).imagefallback||null);a&&$(b).attr("src",a)})}catch(d){console.log("Could not load the image.")}}}[$(b).get(0).tagName]||c)(a)};
$.fn.getBindOptions=function(){return _.extend({reactive:!0,readonly:!1,writeonly:!1},$(this).getAttrs(tagPrefix))};
$.fn.getAttrs=function(a){var b=function(a,b){return({array:function(a){return a.split(",")},"boolean":function(a){return"true"==a?!0:!1}}[{pick:"array",omit:"array",reactive:"boolean",readonly:"boolean",writeonly:"boolean"}[a]||null]||function(){return b})(b)},c={};this.length&&$.each(this[0].attributes,function(g,e){if(a&&startsWith(e.name,a+"-")){var d=a?e.name.slice(a.length+1,e.name.length):e.name,f=b(d,e.value);c[d]=f}});return c};_WAY={data:{},options:{}};
$.setBinding=function(a,b){_WAY.data=deepJSON(_WAY.data,a,b);$.digestBindings(a)};$.getBinding=function(a){return deepJSON(_WAY.data,a)};$.digestBindings=function(a,b){var c=b?"["+tagPrefix+"-data]":"["+tagPrefix+"-data^='"+a.split(".")[0]+"']";$(c).each(function(){var a=$(this).getBindOptions(),b="FORM"==$(this).get(0).tagName&&$(this).get(0)==$(":focus").parents("form").get(0)?!0:!1;a.reactive&&!b&&$(this).fromStorage()})};
var startsWith=function(a,b){if(""===b)return!0;if(null==a||null==b)return!1;a=String(a);b=String(b);return a.length>=b.length&&a.slice(0,b.length)===b},deepJSON=function(a,b,c){var g=b.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"").split("."),e,d=0,f=g.length;if(2<arguments.length){e=a;for(f--;d<f;)b=g[d++],a=a[b]=_.isObject(a[b])?a[b]:{};a[g[d]]=c;c=e}else{for(;null!=(a=a[g[d++]])&&d<f;);c=d<f?void 0:a}return c};